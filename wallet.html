<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—à–µ–ª—ë–∫ - SolarGroup</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header__logo">
            <span class="logo">SolarGroup</span>
        </div>
        <div class="header__controls">
            <div class="language-switcher">
                <button class="lang-btn active" data-lang="ru">RU</button>
                <button class="lang-btn" data-lang="en">EN</button>
            </div>
            <button class="notification-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                <span class="notification-count">2</span>
            </button>
            <div class="user-dropdown" id="userDropdown">
                <div class="user-profile">
                    <div class="user-avatar">–ö</div>
                    <span class="user-name">–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω</span>
                    <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="dropdown-menu">
                    <a href="#" class="dropdown-menu-item">
                        <span class="dropdown-menu-item-icon">üë§</span>
                        –ü—Ä–æ—Ñ–∏–ª—å
                    </a>
                    <a href="#" class="dropdown-menu-item">
                        <span class="dropdown-menu-item-icon">‚öôÔ∏è</span>
                        –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </a>
                    <a href="#" class="dropdown-menu-item">
                        <span class="dropdown-menu-item-icon">üìÑ</span>
                        –î–æ–∫—É–º–µ–Ω—Ç—ã
                    </a>
                    <div class="dropdown-menu-divider"></div>
                    <a href="#" class="dropdown-menu-item" id="logoutBtn">
                        <span class="dropdown-menu-item-icon">üö™</span>
                        –í—ã–π—Ç–∏
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="app-layout">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <ul class="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li class="nav-item"><a href="wallet.html" class="nav-link">–ö–æ—à–µ–ª—ë–∫</a></li>
                <li class="nav-item"><a href="invest.html" class="nav-link">–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</a></li>
                <li class="nav-item"><a href="coupons.html" class="nav-link">–ö—É–ø–æ–Ω—ã –∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1>–ö–æ—à–µ–ª—ë–∫</h1>
            </div>

            <!-- Account Balances -->
            <div class="wallet-section">
                <div class="account-balances">
                    <div class="balance-card">
                        <div class="balance-header">
                            <h3>–û—Å–Ω–æ–≤–Ω–æ–π —Å—á—ë—Ç</h3>
                        </div>
                        <div class="balance-amount">
                            <span class="amount" id="main-balance-amount">0,00 $</span>
                        </div>
                        <div class="balance-actions">
                            <button class="btn btn--primary" id="deposit-main-btn">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                            <button class="btn btn--secondary" id="withdraw-main-btn" disabled>–í—ã–≤–µ—Å—Ç–∏</button>
                        </div>
                    </div>

                    <div class="balance-card">
                        <div class="balance-header">
                            <h3>–ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π —Å—á—ë—Ç</h3>
                        </div>
                        <div class="balance-amount">
                            <span class="amount" id="partner-balance-amount">0,00 $</span>
                        </div>
                        <div class="balance-actions">
                            <button class="btn btn--primary" id="deposit-partner-btn" disabled>–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                            <button class="btn btn--secondary" id="withdraw-partner-btn" disabled>–í—ã–≤–µ—Å—Ç–∏</button>
                        </div>
                    </div>
                </div>

                <!-- Coupons Widget -->
                <div class="coupons-widget">
                    <div class="widget-header">
                        <h2>–í–∞—à–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É–ø–æ–Ω—ã</h2>
                        <button class="btn btn--secondary btn--small">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫—É–ø–æ–Ω—ã</button>
                    </div>
                    <div class="coupons-container" id="wallet-coupons">
                        <!-- Coupons will be populated by JavaScript -->
                        <div class="no-coupons-message">
                            <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—É–ø–æ–Ω–æ–≤</p>
                            <button class="btn btn--primary activate-promo-btn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transaction History -->
            <div class="transaction-history">
                <h2>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
                <div class="history-table-container">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>–¢–∏–ø</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>–°—É–º–º–∞</th>
                                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-tbody"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals and Notifications -->
    <div id="coupon-details-modal" class="modal">
        <div class="modal-content coupon-details-modal">
            <span class="close-modal">&times;</span>
            <div class="modal-body">
                <div class="coupon-detail-header">
                    <h2 id="detail-coupon-name">–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É–ø–æ–Ω–∞</h2>
                    <span class="coupon-project-tag" id="detail-coupon-project">–ü—Ä–æ–µ–∫—Ç</span>
                </div>
                <div class="coupon-detail-main">
                    <div class="coupon-bonus-display">
                        <span class="bonus-amount" id="detail-coupon-bonus">$25</span>
                        <span class="bonus-type">–±–æ–Ω—É—Å</span>
                    </div>
                    <div class="coupon-meta">
                        <div class="meta-item">
                            <span class="meta-label">–ò—Å—Ç–µ–∫–∞–µ—Ç:</span>
                            <span class="meta-value" id="detail-coupon-expiry">15 –æ–∫—Ç—è–±—Ä—è 2025</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">–£—Å–ª–æ–≤–∏—è:</span>
                            <span class="meta-value" id="detail-coupon-conditions">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ $250</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">–ö–æ–¥:</span>
                            <span class="meta-value coupon-code" id="detail-coupon-code">WELCOME25-ABC123</span>
                        </div>
                    </div>
                </div>
                <div class="coupon-actions">
                    <button class="btn btn--primary use-coupon-btn">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
                    <button class="btn btn--secondary copy-code-btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
                </div>
            </div>
        </div>
    </div>

    <div id="activate-promo-modal" class="modal">
        <div class="modal-content promo-activation-modal">
            <span class="close-modal">&times;</span>
            <div class="modal-body">
                <h2>–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</h2>
                <form class="promo-activation-form">
                    <div class="form-group">
                        <label for="promo-code">–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥:</label>
                        <input type="text" id="promo-code" class="form-control" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥">
                    </div>
                    <button type="submit" class="btn btn--primary">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                </form>
            </div>
        </div>
    </div>

    <div id="success-notification" class="notification notification-success">
        <div class="notification-content">
            <span class="notification-icon">‚úì</span>
            <span class="notification-message">–ö—É–ø–æ–Ω —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω—ë–Ω!</span>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Wallet-specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            const userId = 1; // demo user
            const mainBalanceEl = document.getElementById('main-balance-amount');
            const partnerBalanceEl = document.getElementById('partner-balance-amount');
            const txBody = document.getElementById('transactions-tbody');
            const depositMainBtn = document.getElementById('deposit-main-btn');

            async function loadWallet() {
                try {
                    const res = await fetch(`/api/wallet/${userId}`);
                    if (res.ok) {
                        const w = await res.json();
                        if (mainBalanceEl) mainBalanceEl.textContent = `${Number(w.main_balance).toFixed(2)} $`;
                        if (partnerBalanceEl) partnerBalanceEl.textContent = `${Number(w.partner_balance || 0).toFixed(2)} $`;
                    }
                } catch(e) { console.error(e); }
            }

            async function loadTransactions() {
                try {
                    const res = await fetch(`/api/transactions/${userId}`);
                    if (res.ok) {
                        const txs = await res.json();
                        if (txBody) {
                            txBody.innerHTML = txs.map(t => `
                                <tr>
                                  <td>${t.type === 'deposit' ? '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ' : t.type === 'investment' ? '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è' : t.type}</td>
                                  <td>${new Date(t.created_at).toLocaleDateString('ru-RU')}</td>
                                  <td>${t.amount > 0 ? '+' : ''}${Number(t.amount).toFixed(2)} $</td>
                                  <td>${t.description || ''}</td>
                                  <td><span class="status-badge ${t.status === 'completed' ? 'status-success' : 'status-pending'}">${t.status === 'completed' ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ'}</span></td>
                                </tr>
                            `).join('');
                        }
                    }
                } catch(e) { console.error(e); }
            }

            async function depositMain() {
                const amountStr = prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è, USD');
                if (!amountStr) return;
                const amount = parseFloat(amountStr);
                if (isNaN(amount) || amount <= 0) {
                    alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—É–º–º–∞');
                    return;
                }
                try {
                    const res = await fetch('/api/transactions/deposit', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ userId, amount, paymentMethod: 'card' })
                    });
                    const data = await res.json();
                    if (!res.ok) {
                        alert(data.error || '–û—à–∏–±–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è');
                        return;
                    }
                    await loadWallet();
                    await loadTransactions();
                    alert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
                } catch(e) {
                    console.error(e);
                    alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
            }

            if (depositMainBtn) depositMainBtn.addEventListener('click', depositMain);

            loadWallet();
            loadTransactions();
        });
    </script>
</body>
</html>